{
    "$schema": "http://json-schema.org/schema#",
    "type": "object",
    "properties": {
        "elasticsearch": {
            "description": "elasticsearch configuration",
            "type": "object",
            "properties": {
                "image": {
                    "description": "elasticsearch image",
                    "type": "object",
                    "properties": {
                        "registry": {
                            "description": "registry",
                            "type": "string",
                            "default": "docker.io"
                        },
                        "repository": {
                            "description": "repository",
                            "type": "string",
                            "default": "bitnami/elasticsearch"
                        },
                        "tag": {
                            "description": "tag",
                            "type": "string",
                            "default": "8.13.4-debian-12-r0",
                            "enum": [
                                "8.13.4-debian-12-r0",
                                "7.17.3"
                            ]
                        },
                        "pullPolicy": {
                            "type": "string",
                            "description": "option when pulling the docker image",
                            "default": "IfNotPresent",
                            "enum": [
                                "IfNotPresent",
                                "Always",
                                "Never"
                            ]
                        }
                    }
                },
                "security": {
                    "description": "elasticsearch security specific configuration",
                    "type": "object",
                    "properties": {
                        "elasticPassword": {
                            "type": "string",
                            "description": "Password",
                            "default": "changeme",
                            "render": "password",
                            "x-onyxia": {
                                "overwriteDefaultWith": "{{project.password}}"
                            }
                        }
                    }
                },
                "kibana": {
                    "description": "kibana specific configuration",
                    "type": "object",
                    "properties": {
                        "elasticsearch": {
                            "type": "object",
                            "properties": {
                                "security": {
                                    "type": "object",
                                    "properties": {
                                        "auth": {
                                            "type": "object",
                                            "properties": {
                                                "type": "string",
                                                "description": "Password",
                                                "default": "changeme",
                                                "render": "password",
                                                "x-onyxia": {
                                                    "overwriteDefaultWith": "{{project.password}}"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "ingress": {
            "type": "object",
            "form": true,
            "title": "Ingress Details",
            "properties": {
                "enabled": {
                    "description": "Enable Ingress",
                    "type": "boolean",
                    "default": true,
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "k8s.ingress"
                    }
                },
                "hostname": {
                    "type": "string",
                    "form": true,
                    "title": "Hostname",
                    "x-form": {
                        "hidden": true,
                        "value": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
                    },
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
                    }
                },
                "ingressClassName": {
                    "type": "string",
                    "form": true,
                    "title": "ingressClassName",
                    "default": "",
                    "x-form": {
                        "hidden": true,
                        "value": "{{k8s.ingressClassName}}"
                    },
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "{{k8s.ingressClassName}}"
                    }
                }
            }
        },
        "ingressKibana": {
            "type": "object",
            "form": true,
            "title": "Kibana Ingress Details",
            "properties": {
                "enabled": {
                    "description": "Enable Ingress",
                    "type": "boolean",
                    "default": true,
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "k8s.ingress"
                    }
                },
                "hostname": {
                    "type": "string",
                    "form": true,
                    "title": "Hostname",
                    "x-form": {
                        "hidden": true,
                        "value": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
                    },
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "{{project.id}}-kibana-{{k8s.randomSubdomain}}.{{k8s.domain}}"
                    }
                },
                "ingressClassName": {
                    "type": "string",
                    "form": true,
                    "title": "ingressClassName",
                    "default": "",
                    "x-form": {
                        "hidden": true,
                        "value": "{{k8s.ingressClassName}}"
                    },
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "{{k8s.ingressClassName}}"
                    }
                }
            }
        },
        "route": {
            "type": "object",
            "form": true,
            "title": "Route details",
            "properties": {
                "enabled": {
                    "description": "Enable route",
                    "type": "boolean",
                    "default": false,
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "k8s.route"
                    }
                },
                "hostname": {
                    "type": "string",
                    "form": true,
                    "title": "Hostname",
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
                    }
                }
            }
        },
        "routeKibana": {
            "type": "object",
            "form": true,
            "title": "Route details",
            "properties": {
                "enabled": {
                    "description": "Enable route",
                    "type": "boolean",
                    "default": false,
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "k8s.route"
                    }
                },
                "hostname": {
                    "type": "string",
                    "form": true,
                    "title": "Hostname",
                    "x-onyxia": {
                        "hidden": true,
                        "overwriteDefaultWith": "{{project.id}}-kibana-{{k8s.randomSubdomain}}.{{k8s.domain}}"
                    }
                }
            }
        },
        "security": {
            "description": "security specific configuration",
            "type": "object",
            "properties": {
                "allowlist": {
                    "type": "object",
                    "description": "IP protection",
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "title": "Enable IP protection",
                            "description": "Only the configured set of IPs will be able to reach the service",
                            "default": true,
                            "x-onyxia": {
                                "overwriteDefaultWith": "region.defaultIpProtection"
                            }
                        },
                        "ip": {
                            "type": "string",
                            "description": "the white list of IP is whitespace",
                            "title": "Whitelist of IP",
                            "x-onyxia": {
                                "overwriteDefaultWith": "{{user.ip}}"
                            },
                            "hidden": {
                                "value": false,
                                "path": "security/allowlist/enabled"
                            }
                        }
                    }
                },
                "networkPolicy": {
                    "type": "object",
                    "description": "Define access policy to the service",
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "title": "Enable network policy",
                            "description": "Only pod from the same namespace will be allowed",
                            "default": true,
                            "x-onyxia": {
                                "overwriteDefaultWith": "region.defaultNetworkPolicy"
                            }
                        },
                        "from": {
                            "type": "array",
                            "description": "Array of source allowed to have network access to your service",
                            "default": [],
                            "x-onyxia": {
                                "hidden": true,
                                "overwriteDefaultWith": "region.from"
                            }
                        }
                    }
                }
            }
        }
    }
}